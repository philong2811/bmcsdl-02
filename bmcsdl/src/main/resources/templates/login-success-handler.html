<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Đang Xử Lý Đăng Nhập...</title>
</head>
<body>
<div style="text-align: center; padding-top: 100px;">
  <h2>Đang xử lý đăng nhập, vui lòng chờ...</h2>
</div>

<script th:inline="javascript">

  const token = [[${token}]];
  const role = [[${role}]];

  if (token && role && role !== 'null' && token !== 'null') {
    localStorage.setItem('token', token);
    localStorage.setItem('role', role);

    let redirectPath = '/home';

    switch(role) {
      case 'XT':
        redirectPath = '/xt/home';
        break;
      case 'XD':
        redirectPath = '/xd/home';
        break;
      case 'LT':
        redirectPath = '/lt/home';
        break;
      case 'GS':
        redirectPath = '/gs/home';
        break;
    }

    fetch(redirectPath, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (response.ok) {
        window.location.replace(redirectPath);
      } else {
        console.error("Truy cập bị từ chối.");
        window.location.replace('/login?error=true');
      }
    })
    .catch(error => {
      console.error("Có lỗi xảy ra: ", error);
      window.location.replace('/login?error=true');
    });
  }
</script>
</body>
</html>
